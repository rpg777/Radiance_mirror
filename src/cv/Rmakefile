# SCCSid "$SunId$ LBL"

#
# Makefile for conversion programs
#

OPT = -O

MACH = -DBSD

CFLAGS = $(OPT) $(MACH) -I../common -L../lib

CC = cc

MLIB = -lm

INSTDIR = /usr/local/bin

LIBDIR = /usr/local/lib/ray

PROGS = thf2rad ies2rad arch2rad nff2rad lampcolor tmesh2rad obj2rad mgf2rad

LIBFILES = source.cal tilt.cal lamp.tab tmesh.cal

all:	$(PROGS)

install:	$(PROGS) $(LIBFILES)
	cp $(PROGS) $(INSTDIR)
	cd $(LIBDIR) ; rm -f $(LIBFILES)
	cp $(LIBFILES) $(LIBDIR)

clean:
	set nonomatch; rm -f $(PROGS) *.o core

thf2rad:	thf2rad.o
	$(CC) $(CFLAGS) -o thf2rad thf2rad.o

ies2rad:	ies2rad.o
	$(CC) $(CFLAGS) -o ies2rad ies2rad.o -lrt

arch2rad:	arch2rad.o trans.o
	$(CC) $(CFLAGS) -o arch2rad arch2rad.o trans.o -lrt

nff2rad:	nff2rad.o
	$(CC) $(CFLAGS) -o nff2rad nff2rad.o

lampcolor:	lampcolor.o
	$(CC) $(CFLAGS) -o lampcolor lampcolor.o -lrt

tmesh2rad:	tmesh2rad.o tmesh.o
	$(CC) $(CFLAGS) -o tmesh2rad tmesh2rad.o tmesh.o -lrt $(MLIB)

obj2rad:	obj2rad.o trans.o tmesh.o
	$(CC) $(CFLAGS) -o obj2rad obj2rad.o trans.o tmesh.o -lrt $(MLIB)

mgf2rad:	mgf2rad.o ../lib/libmgf.a
	$(CC) $(CFLAGS) -o mgf2rad mgf2rad.o tmesh.o -lmgf -lrt $(MLIB)

../lib/libmgf.a:
	cd mgflib ; \
	make libmgf.a CFLAGS="$(OPT) $(MACH) '-DMEM_PTR=char *' -DNOPROTO" ; \
	mv libmgf.a ../../lib

mgf2rad.o:	mgflib/parser.h tmesh.h

arch2rad.o trans.o:	trans.h

ies2rad.o lampcolor.o:	../common/color.h

ies2rad.o:	../common/paths.h

obj2rad.o tmesh2rad.o:	tmesh.h \
../common/standard.h ../common/mat4.h ../common/fvect.h

obj2rad.o:	trans.h

tmesh.o:	tmesh.h ../common/fvect.h
